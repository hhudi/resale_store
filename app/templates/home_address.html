{% extends "home_base.html" %}
{% block title %}个人中心{% endblock title %}
{% block css %}
{{ super() }}
<style type="text/css">
.address_list{
}
.address_list > div{
        background: #eee;
        margin: 20px;
        padding: 10px 20px;
        font-size: 1.8rem;
}
.add_address_dialog{
    display: none;
    position: fixed;
    width: 80%;
    height: 300px;
    top: 20%;
    left: 10%;
    background: #fff;
    box-shadow: 10px 10px 10px #666;
    z-index: 9999;
    padding: 20px;
    margin: 20px;
}
</style>
{% endblock css %}

{% block home_right_container %}
<div style="text-align: center;"><button onclick="show_add_dialog()">添加收货地址</button></div>

<div class="address_list">
    {% if addresss %}
        {% for ad in addresss%}
            <div>
                <p>地址：{{ad.address}}</p>
                <p>联系人：{{ad.people}}</p>
                <p>手机：{{ad.mobile}}</p>
                <button class="del_address_btn" onclick="del_address('{{ad.sn}}')">删除</button>
            </div>
        {% endfor %}
    {% else %}
        <div style="text-align: center;">没有收货地址</div>
    {% endif %}
</div>

<div class="add_address_dialog">
    <div style="text-align: right;"><button  onclick="close_add_dialog()">关闭</button></div>
    <div style="text-align: center;">
        <form action="/address" method="POST" onsubmit="return vaild_address_form()">
            <div><input type="address" name="address" placeholder="address"></div>
            <div><input type="people" name="people" placeholder="people"></div>
            <div><input type="mobile" name="mobile" placeholder="mobile"></div>
            <div><button>保存</button></div>
        </form>
    </div>
</div>
{% endblock home_right_container %}

{% block js %}
{{ super() }}
<script type="text/javascript">
function vaild_address_form(){
    var has_empty_data = false;
    $(".add_address_dialog input").each(function(){
        if($(this).val()==''){
            has_empty_data = true;
        };
    });
    if (has_empty_data){
        alert("请填写完整");
        return false;
    }
}
function show_add_dialog(){
    $(".add_address_dialog").show();
}
function close_add_dialog(){
    $(".add_address_dialog").hide();
    $(".add_address_dialog input").val("");
}
function del_address(address_sn){
    $.ajax({
        url:"/address/"+address_sn,
        type:'DELETE',
        dataType: 'json',
        success:function(Data){
            console.log(Data);
            if (Data.code==0){
                location.reload();
            }else{
                alert(Data.msg);
            }
        },
        error:function(){
          alert("delete address error");
        }
    });
}
</script>
{% endblock js %}
